"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../api/api.js"),_api2=_interopRequireDefault(_api),_util=require("./../utils/util.js"),_util2=_interopRequireDefault(_util);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,n){try{var o=s[e](n),r=o.value}catch(e){return void i(e)}if(!o.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Student=function(){function u(){var e,t,n,o,r;_classCallCheck(this,u);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return(t=n=_possibleConstructorReturn(this,(e=u.__proto__||Object.getPrototypeOf(u)).call.apply(e,[this].concat(i)))).components={},n.data={name:"",sexIndex:0,sexArr:["男","女"],date:"2014-01-01",gradeArr:["一年级","二年级","三年级","四年级","五年级","六年级"],gradeIndex:0,region:[],upload_pic:[],uploadUrl:"",IDCard:"",mobile:"",school_name:"",address:"",student_id:"",teacher_name:"",parents_wx:""},n.methods={bindSave:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("======>>> 保存222",t.detail.value),n=this,o=t.detail.value,e.next=5,_api2.default.editStudentInfo({query:{user_id:_wepy2.default.$instance.globalData.userInfo.id,name:o.studentName,gender:Number(o.sex)+1,birth_time:o.date,parents_phone:o.mobile,parents_wx:"1",school_name:o.schoolName,school_grade:n.gradeArr[o.grade],school_class:"1班",idno:o.IDCard,adviser:"张老师",student_photo:n.uploadUrl,student_id:n.student_id,province:o.region[0],city:o.region[1],area:o.region[2],address_detail:o.address}});case 5:r=e.sent,console.log("-------\x3e add",r),1==r.data.status?(a=""==n.student_id?"添加成功":"修改成功",_wepy2.default.showToast({title:a,duration:2e3,mask:!0,success:function(){}}),setTimeout(function(){_wepy2.default.navigateBack()},2e3)):_wepy2.default.showToast({title:r.data.msg,duration:2e3});case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),bindSexChange:function(e){console.log("====sex change===",e),this.sexIndex=e.detail.value},bindDateChange:function(e){console.log("====date change===",e),this.date=e.detail.value},bindGradeChange:function(e){console.log("====grade change===",e),this.gradeIndex=e.detail.value},bindRegionChange:function(e){console.log("====region change===",e),this.region=e.detail.value},chooseImage:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,console.log("=======> add"),e.next=4,_wepy2.default.chooseImage({count:"1"});case 4:if("chooseImage:ok"!=(o=e.sent).errMsg){e.next=17;break}for(a in _wepy2.default.showToast({title:"图片成功"}),r=o.tempFilePaths)n.upload_pic.push(r[a]);return e.next=11,_util2.default.uploadFileImg(n.upload_pic[0]);case 11:i=e.sent,console.log("... ",i),1==i.status&&(n.uploadUrl=i.uri),n.$apply(),e.next=18;break;case 17:wx.showToast({title:"操作失败"});case 18:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),previewImgTap:function(){wx.previewImage({current:this.upload_pic[0],urls:this.upload_pic})},deletePic:function(){this.upload_pic=[],this.uploadUrl="",this.$apply()}},n.events={updateEditInfo:function(e){console.log("======> 子组件更新22",e);var t=this;t.name=e.name,t.sexIndex=Number(e.gender)-1,t.date=e.birth_time,t.gradeIndex=t.gradeArr.indexOf(e.school_grade),t.upload_pic=[e.student_photo.url],t.uploadUrl=e.student_photo.file,t.student_id=e.student_id||"",t.school_name=e.school_name,t.mobile=e.parents_phone,t.IDCard=e.idno,t.address=e.address_detail,t.region=[e.province,e.city,e.area],t.$apply()}},_possibleConstructorReturn(n,t)}return _inherits(u,_wepy2.default.component),u}();exports.default=Student;