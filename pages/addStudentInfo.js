"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../api/api.js"),_api2=_interopRequireDefault(_api),_util=require("./../utils/util.js"),_util2=_interopRequireDefault(_util);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,n){try{var r=s[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var addStudentInfo=function(){function u(){var e,t,n,r,o;_classCallCheck(this,u);for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];return(t=n=_possibleConstructorReturn(this,(e=u.__proto__||Object.getPrototypeOf(u)).call.apply(e,[this].concat(i)))).config={navigationBarTitleText:"添加学生信息2"},n.components={},n.data={name:"",sexIndex:0,sexArr:["男","女"],sex:"",date:"2014-01-01",gradeArr:["一年级","二年级","三年级","四年级","五年级","六年级"],gradeIndex:0,region:[],upload_pic:[],uploadUrl:"",student_id:""},n.methods={bindSexChange:function(e){console.log("====sex change===",e),this.sexIndex=e.detail.value},bindDateChange:function(e){console.log("====date change===",e),this.date=e.detail.value},bindGradeChange:function(e){console.log("====grade change===",e),this.gradeIndex=e.detail.value},bindRegionChange:function(e){console.log("====region change===",e),this.region=e.detail.value},bindSave:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("======>>> 保存",t.detail.value),n=this,r=t.detail.value,e.next=5,_api2.default.editStudentInfo({query:{user_id:n.$parent.globalData.userInfo.id,name:r.studentName,gender:Number(r.sex)+1,birth_time:r.date,parents_phone:r.mobile,parents_wx:"1",school_name:r.schoolName,school_grade:n.gradeArr[r.grade],school_class:"1班",idno:r.IDCard,adviser:"张老师",student_photo:n.uploadUrl,province:r.region[0],city:r.region[1],area:r.region[2],address_detail:r.address}});case 5:o=e.sent,console.log("-------\x3e add",o),1==o.data.status?(_wepy2.default.showToast({title:"添加成功",duration:2e3,mask:!0,success:function(){}}),setTimeout(function(){_wepy2.default.navigateBack()},2e3)):_wepy2.default.showToast({title:o.data.msg,duration:2e3});case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),chooseImage:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,console.log("=======> add"),e.next=4,_wepy2.default.chooseImage({count:"1"});case 4:if("chooseImage:ok"!=(r=e.sent).errMsg){e.next=17;break}for(a in _wepy2.default.showToast({title:"图片成功"}),o=r.tempFilePaths)n.upload_pic.push(o[a]);return e.next=11,_util2.default.uploadFileImg(n.upload_pic[0]);case 11:i=e.sent,console.log("... ",i),1==i.status&&(n.uploadUrl=i.uri),n.$apply(),e.next=18;break;case 17:wx.showToast({title:"操作失败"});case 18:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),previewImgTap:function(){wx.previewImage({current:this.upload_pic[0],urls:this.upload_pic})},deletePic:function(){this.upload_pic=[],this.uploadUrl="",this.$apply()}},n.events={},_possibleConstructorReturn(n,t)}var e;return _inherits(u,_wepy2.default.page),_createClass(u,[{key:"onLoad",value:function(e){console.log("------edit/add-------",e),this.student_id=e.student_id||"",""!=this.student_id&&this.loadStudentInfo()}},{key:"loadStudentInfo",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,_api2.default.studentGetInfo({user_id:t.$parent.globalData.userInfo.id,student_id:t.student_id});case 3:n=e.sent,console.log("=====> get info",n,t.student_id);case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]),u}();exports.default=addStudentInfo;