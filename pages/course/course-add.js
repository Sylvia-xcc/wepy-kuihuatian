"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../../api/api.js"),_api2=_interopRequireDefault(_api),_tip=require("./../../utils/tip.js"),_tip2=_interopRequireDefault(_tip),_util=require("./../../utils/util.js"),_util2=_interopRequireDefault(_util);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var u=e.apply(this,arguments);return new Promise(function(o,s){return function t(e,r){try{var a=u[e](r),n=a.value}catch(e){return void s(e)}if(!a.done)return Promise.resolve(n).then(function(e){t("next",e)},function(e){t("throw",e)});o(n)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var courseAdd=function(){function i(){var e,t,r,a,n;_classCallCheck(this,i);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return(t=r=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(s)))).config={navigationBarTitleText:"添加课程"},r.components={},r.data={courseName:"",date:"2019-10-12",startTime:"0:00",endTime:"0:00",teachers:[],teachersName:[],teacherId:-1,courseNum:"",uploadImage:"",uploadUrl:"",showStudentList:!1,students:[],chooseStudents:[],courseId:"",goodsId:-1,goods:[],goodsName:[],today:""},r.methods={addTap:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this).teacherId<0)return _tip2.default.success("请选择老师"),e.abrupt("return");e.next=4;break;case 4:if(r.goodsId<0)return _tip2.default.success("请选择商品"),e.abrupt("return");e.next=7;break;case 7:return e.next=9,_api2.default.loadCourseAdd({query:{course_name:r.courseName,course_date:r.date,start_time:r.startTime,end_time:r.endTime,lecturer:r.teachers[r.teacherId].id||0,course_num:r.courseNum,thumb:r.uploadUrl,course_id:r.courseId,goods_id:r.goods[r.goodsId].id||0}});case 9:if(a=e.sent,console.log("---------- fabu course",a),1==a.data.status)return n=0<this.courseId?"修改成功":"添加成功",e.next=15,_tip2.default.success(n,1200);e.next=18;break;case 15:_wepy2.default.navigateBack({delta:1}),e.next=19;break;case 18:_tip2.default.error(a.data.msg);case 19:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),backTap:function(){_wepy2.default.navigateBack({delta:1})},removeTap:function(){},tabTap:function(){this.showStudentList=!this.showStudentList,console.log(this.showStudentList),this.$apply()},bindCourseNameInput:function(e){this.courseName=e.detail.value,this.$apply()},bindCourseNumInput:function(e){this.courseNum=e.detail.value,this.$apply()},bindDateChange:function(e){console.log("-----课程日期：",e.detail),this.date=e.detail.value,this.$apply()},bindStartTimeChange:function(e){console.log("-----开始时间：",e.detail),this.startTime=e.detail.value},bindEndTimeChange:function(e){console.log("-----结束时间：",e.detail),this.endTime=e.detail.value},bindTeacherChange:function(e){console.log("-----老师选择：",e.detail),this.teacherId=e.detail.value},bindStudentChange:function(e){console.log("-----学生选择：",e.detail),this.chooseStudents=e.detail.value},bindGoodsChange:function(e){console.log("-----商品选择：",e.detail),this.goodsId=e.detail.value},chooseImage:(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,e.next=3,_wepy2.default.chooseImage({count:"1"});case 3:if(a=e.sent,console.log("====?????? ",a),"chooseImage:ok"==a.errMsg)return n=a.tempFilePaths,r.uploadImage=n[0],e.next=10,_util2.default.uploadFileImg(r.uploadImage);e.next=16;break;case 10:o=e.sent,console.log("... ",o),1==o.status&&(r.uploadUrl=o.uri),r.$apply(),e.next=17;break;case 16:_tip2.default.error("操作失败");case 17:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),previewImgTap:function(){wx.previewImage({current:this.uploadImage,urls:[this.uploadImage]})}},r.events={},_possibleConstructorReturn(r,t)}var e,t,r,a,n;return _inherits(i,_wepy2.default.page),_createClass(i,[{key:"onLoad",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),this.courseId=t.courseId||0,0<this.courseId&&_wepy2.default.setNavigationBarTitle({title:"编辑课程"}),this.date=_util2.default.getTodayDate(),this.today=this.date,e.next=7,this.loadTeacherList();case 7:return e.next=9,this.loadCourseGoodsList();case 9:0<this.courseId&&this.loadCourseInfo();case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"loadCourseInfo",value:(a=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,_tip2.default.loading(),e.next=4,_api2.default.loadCourseInfo({query:{course_id:t.courseId}});case 4:if(r=e.sent,console.log("--------- load course ",r),1==r.data.status){for(a=r.data.data,t.courseNum=a.course_num,t.startTime=a.start_time,t.endTime=a.end_time,t.courseName=a.course_name,t.uploadUrl=a.thumb.file,t.uploadImage=a.thumb.url,t.date=a.full_course_date,n=0;n<t.teachers.length;n++)a.lecturer.id==t.teachers[n].id&&(t.teacherId=n);for(o=0;o<t.goods.length;o++)a.goods_id==t.goods[o].id&&(t.goodsId=o)}_tip2.default.loaded(),t.$apply();case 9:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"loadTeacherList",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,_api2.default.loadCourseTeacherList();case 3:if(r=e.sent,console.log("--------- load teachers ",r),1==r.data.status)for(t.teachers=r.data.data,t.teachersName=[],a=0;a<t.teachers.length;a++)t.teachersName.push(t.teachers[a].nickname);t.$apply();case 7:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"loadCourseGoodsList",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,_api2.default.loadCourseGoodsList();case 3:if(r=e.sent,console.log("--------- load goods ",r),1==r.data.status)for(t.goods=r.data.data,a=0;a<t.goods.length;a++)t.goodsName.push(t.goods[a].name);t.$apply();case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"loadStudentList",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,_api2.default.studentList({query:{user_id:t.$parent.globalData.userInfo.id}});case 3:r=e.sent,console.log("--------- load students ",r),1==r.data.status&&(t.students=r.data.data),t.$apply();case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]),i}();Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(courseAdd,"pages/course/course-add"));