"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../api/api.js"),_api2=_interopRequireDefault(_api),_tip=require("./../utils/tip.js"),_tip2=_interopRequireDefault(_tip),_util=require("./../utils/util.js"),_util2=_interopRequireDefault(_util),_bomb_screen=require("./../components/bomb_screen.js"),_bomb_screen2=_interopRequireDefault(_bomb_screen),_layoutOne=require("./../components/layout/layout-one.js"),_layoutOne2=_interopRequireDefault(_layoutOne),_layoutTwo=require("./../components/layout/layout-two.js"),_layoutTwo2=_interopRequireDefault(_layoutTwo),_layoutThree=require("./../components/layout/layout-three.js"),_layoutThree2=_interopRequireDefault(_layoutThree),_layoutScroll=require("./../components/layout/layout-scroll.js"),_layoutScroll2=_interopRequireDefault(_layoutScroll),_loading=require("./../components/common/loading.js"),_loading2=_interopRequireDefault(_loading);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var l=e.apply(this,arguments);return new Promise(function(a,r){return function t(e,o){try{var n=l[e](o),i=n.value}catch(e){return void r(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});a(i)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Home=function(){function r(){var e,t,o;_classCallCheck(this,r);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=o=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(i)))).config={},o.$repeat={list:{com:"layoutscroll",props:"datas.sync"}},o.$props={layoutone:{"xmlns:v-bind":{value:"",for:"list",item:"item",index:"index",key:"index"},"v-bind:datas.sync":{value:"item",type:"item",for:"list",item:"item",index:"index",key:"index"},"v-bind:vip.sync":{value:"vip",for:"list",item:"item",index:"index",key:"index"}},layouttwo:{"v-bind:datas.sync":{value:"item",type:"item",for:"list",item:"item",index:"index",key:"index"},"v-bind:vip.sync":{value:"vip",for:"list",item:"item",index:"index",key:"index"}},layoutthree:{"v-bind:datas.sync":{value:"item",type:"item",for:"list",item:"item",index:"index",key:"index"},"v-bind:vip.sync":{value:"vip",for:"list",item:"item",index:"index",key:"index"}},layoutscroll:{"v-bind:datas.sync":{value:"item",type:"item",for:"list",item:"item",index:"index",key:"index"},"v-bind:vip.sync":{value:"vip",for:"list",item:"item",index:"index",key:"index"}},loading:{"xmlns:v-bind":"","v-bind:show.sync":"showLoading",message:"疯狂加载中..."},bombscreen:{"xmlns:v-bind":"","v-bind:types.sync":"tps","v-bind:show.sync":"is_show_alert","xmlns:v-on":""}},o.$events={bombscreen:{"v-on:close":"closeAlert","v-on:callback":"alertCallback"}},o.components={layoutone:_layoutOne2.default,layouttwo:_layoutTwo2.default,layoutthree:_layoutThree2.default,layoutscroll:_layoutScroll2.default,loading:_loading2.default,bombscreen:_bomb_screen2.default},o.data={bannerList:[],list:[],windowHeight:0,timer:0,loaded:!1,showLoading:!0,tps:2,is_show_alert:!1,vip:0},o.methods={setContainerHeight:function(e){var t=e.detail.width,o=e.detail.height,n=wx.getSystemInfoSync().screenWidth/t;this.windowHeight=o*n,this.$apply()},swiperTap:function(e){var t=e.currentTarget.dataset.url;""!=t&&_wepy2.default.navigateTo({url:t})},onShareAppMessage:function(e){return"button"===e.from&&console.log(e.target),{title:"葵花田艺术",path:"/pages/home",success:function(){},fail:function(){}}},alertCallback:function(){_wepy2.default.navigateTo({url:"/pages/activity-list"})},closeAlert:function(){}},o.events={onSwitchTap:function(e){_wepy2.default.navigateTo({url:"/pages/home-list?value="+e.value})}},_possibleConstructorReturn(o,t)}var e,t;return _inherits(r,_wepy2.default.page),_createClass(r,[{key:"onLoad",value:function(){console.log("------home onLoad -------")}},{key:"onShow",value:function(){console.log("---------- home onShow -------",_wepy2.default.$instance.globalData.checkLogin);var e=this;_wepy2.default.$instance.globalData.checkLogin?(console.log("------ home AAA"),e.initHome()):e.$parent.checkLoginReadyCallback=function(){console.log("------ home  BBB"),e.initHome()}}},{key:"onHide",value:function(){console.log("------ onHide home"),clearTimeout(this.timer),this.timer=0}},{key:"initHome",value:function(){this.vip=_util2.default.getVip(),console.log("----vip ",this.vip),this.loadHomeInfo(),this.loadActivityList()}},{key:"loadHomeInfo",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).showLoading=!1,_tip2.default.loading(),e.next=5,_api2.default.loadHomeInfo();case 5:o=e.sent,console.log("------  home info",o),1==o.data.status?(t.bannerList=o.data.banner,t.list=o.data.goods,t.$apply(),t.loaded=!0):_tip2.default.error("网络异常",1e3),_tip2.default.loaded(),t.startCount();case 10:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"loadActivityList",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,_api2.default.loadActivityList({query:{page:t.page}});case 3:1==(o=e.sent).data.status&&(t.is_show_alert=!(o.data.data.length<=0),console.log("------ load Activity list;",o,t.is_show_alert)),t.$apply();case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"startCount",value:function(){var e=this;e.updateItem(),e.timer=setTimeout(function(){e.startCount()},1e3)}},{key:"updateItem",value:function(){for(var e=0;e<this.list.length;e++){var t=this.list[e];if(20==t.goods_type.value)for(var o=0;o<t.goods_lists.length;o++){var n=t.goods_lists[o];if(n.showMask=20==n.goods_type.value||10==n.goods_type.value,20==n.goods_type.value){n.showTimer=!0;var i=(new Date).getTime(),a=1e3*n.seckill_end;n.timeTip=a<i?"":_util2.default.formatTime3(i,a)}else n.showTimer=!1,n.timeTip=""}}this.$apply()}}]),r}();Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Home,"pages/home"));