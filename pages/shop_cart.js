"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../api/api.js"),_api2=_interopRequireDefault(_api),_util=require("./../utils/util.js"),_util2=_interopRequireDefault(_util),_tip=require("./../utils/tip.js"),_tip2=_interopRequireDefault(_tip);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var o=t.apply(this,arguments);return new Promise(function(i,s){return function e(t,r){try{var a=o[t](r),n=a.value}catch(t){return void s(t)}if(!a.done)return Promise.resolve(n).then(function(t){e("next",t)},function(t){e("throw",t)});i(n)}("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var shopCart=function(){function s(){var t,e,r;_classCallCheck(this,s);for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=r=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(n)))).config={navigationBarTitleText:"购物车"},r.components={},r.data={carts:[],uid:0,totalPrice:0,selectAllStatus:!0,selectAllNum:0,isEdit:!1},r.methods={detailTap:function(t){var e=t.currentTarget.dataset.pid;_wepy2.default.navigateTo({url:"/pages/goods_detail?productId="+e})},selectAll:function(){var t=this;t.selectAllStatus=!t.selectAllStatus;for(var e=0;e<t.carts.length;e++)t.carts[e].selected=t.selectAllStatus;t.getTotalPrice()},selectList:function(t){var e=this,r=t.currentTarget.dataset.index;e.carts[r].selected=!e.carts[r].selected,e.getTotalPrice()},addCount:function(t){var e=t.currentTarget.dataset.index,r=parseInt(this.carts[e].num),a=t.currentTarget.dataset.cartid;r+=1,this.addGoodNum(a,r,e)},minusCount:function(t){var e=t.currentTarget.dataset.index,r=parseInt(this.carts[e].num),a=t.currentTarget.dataset.cartid;r<=1?_wepy2.default.showModal({title:"提示",content:"最小购买数量为1",showCancel:!1}):(r-=1,this.addGoodNum(a,r,e))},deleteList:function(t){var e=t.currentTarget.dataset.index,r=this.carts[e].id;this.deleteGood(r)},delAll:function(){for(var t=[],e=0;e<this.carts.length;e++)1==this.carts[e].selected&&t.push(this.carts[e].id+",");t.length<=0?_wepy2.default.showToast({title:"请选择删除的商品",icon:"none",duration:2e3,mask:!0}):this.deleteGood(t)},onCancelEdit:function(){this.isEdit=!this.isEdit},onClickJieSuan:function(){for(var t="",e=0;e<this.carts.length;e++)this.carts[e].selected&&(t+=this.carts[e].id+",");""!==t?_wepy2.default.navigateTo({url:"/pages/pay-cart?cartId="+t}):_wepy2.default.showToast({title:"请选择商品！",icon:"success",duration:2e3,mask:!0})}},r.events={},_possibleConstructorReturn(r,e)}var e,a,t;return _inherits(s,_wepy2.default.page),_createClass(s,[{key:"onLoad",value:function(){}},{key:"onShow",value:function(){_util2.default.hasAuthorize()&&(this.uid=this.$parent.globalData.userInfo.id,this.getCartList())}},{key:"getCartList",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,_tip2.default.loading(),t.next=4,_api2.default.cartList({query:{uid:e.uid}});case 4:if(r=t.sent,console.log("----cartlist ",r),1==r.data.status){for(e.carts=r.data.cart_list,a=0;a<e.carts.length;a++)e.carts[a].selected=!0;e.getTotalPrice()}_tip2.default.loaded(),e.$apply();case 9:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"addGoodNum",value:(a=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r,a){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this,t.next=3,_api2.default.cartUpdateNum({query:{uid:n.uid,num:r,cart_id:e}});case 3:i=t.sent,console.log("---cart update num ",i),1==i.data.status&&(n.carts[a].num=r,n.getTotalPrice()),n.$apply();case 7:case"end":return t.stop()}},t,this)})),function(t,e,r){return a.apply(this,arguments)})},{key:"deleteGood",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,_wepy2.default.showModal({title:"提示",content:"确认将该物品从购物车中移除？"});case 3:if(t.sent.confirm)return t.next=7,_api2.default.cartDel({query:{uid:r.uid,cart_id:e}});t.next=10;break;case 7:a=t.sent,console.log("cart delete ",a),1==a.data.status&&r.getCartList();case 10:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getTotalPrice",value:function(){for(var t=this,e=0,r=0,a=0,n=0;n<t.carts.length;n++)t.carts[n].selected&&(e+=parseInt(t.carts[n].num)*t.carts[n].price,r+=parseInt(t.carts[n].num),a++);t.selectAllStatus=a>=t.carts.length,t.totalPrice=e.toFixed(2),t.selectAllNum=r}}]),s}();Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(shopCart,"pages/shop_cart"));