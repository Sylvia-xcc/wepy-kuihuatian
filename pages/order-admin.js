"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_api=require("./../api/api.js"),_api2=_interopRequireDefault(_api),_util=require("./../utils/util.js"),_util2=_interopRequireDefault(_util),_tip=require("./../utils/tip.js"),_tip2=_interopRequireDefault(_tip),_bottomLoadMore=require("./../components/common/bottomLoadMore.js"),_bottomLoadMore2=_interopRequireDefault(_bottomLoadMore);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var u=e.apply(this,arguments);return new Promise(function(a,i){return function t(e,r){try{var n=u[e](r),o=n.value}catch(e){return void i(e)}if(!n.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});a(o)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var orderAdmin=function(){function u(){var e,t,r,n;_classCallCheck(this,u);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=r=_possibleConstructorReturn(this,(e=u.__proto__||Object.getPrototypeOf(u)).call.apply(e,[this].concat(a)))).config={navigationBarTitleText:"订单管理"},r.$repeat={},r.$props={bottomLoadMore:{"xmlns:v-bind":"","v-bind:show.sync":"showBottomLoading",message:"正在加载"}},r.$events={},r.components={bottomLoadMore:_bottomLoadMore2.default},r.data={status:["all","confirm","deliver","receive","finish"],orderlist:[],showBottomLoading:!1,haveMore:!0,page:1,currentTab:1},r.methods={tabTap:function(e){var t=e.currentTarget.dataset.current,r=this;r.currentTab!=t&&(r.currentTab=parseInt(t),r.page=1,r.haveMore=!0,r.loadAdminOrderList())},detailTap:function(e){var t=e.currentTarget.dataset.oid;_wepy2.default.navigateTo({url:"/pages/order-detail?order_id="+t})},surepayTap:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,n=t.currentTarget.dataset.id,o=t.currentTarget.dataset.ordersn,e.next=5,_tip2.default.confirm("是否‘确认收款’？");case 5:r.paySure(n,o);case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},r.events={},_possibleConstructorReturn(r,t)}var r,e;return _inherits(u,_wepy2.default.page),_createClass(u,[{key:"onLoad",value:function(){this.loadAdminOrderList()}},{key:"loadAdminOrderList",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=this).status[t.currentTab],e.next=4,_api2.default.loadOrderList({query:{uid:t.$parent.globalData.userInfo.id,order_type:r,page:t.page,type:1}});case 4:n=e.sent,console.log("===== load admin order list: ",n),1==n.data.status&&(o=t.orderlist,o=1==t.page?n.data.ord:o.concat(n.data.ord),t.orderlist=o,t.haveMore=0<n.data.ord.length),t.$apply();case 8:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"paySure",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("--------- ",r,t),n=this,e.next=4,_api2.default.sureAdminOrder({query:{uid:n.$parent.globalData.userInfo.id,order_sn:r||0}});case 4:if(o=e.sent,console.log("===== load sure order: ",o),1==o.data.status)return e.next=9,_tip2.default.success("确认收款成功",1e3);e.next=12;break;case 9:_wepy2.default.redirectTo({url:"/pages/order-admin?currentTab=2"}),e.next=13;break;case 12:_tip2.default.error(o.data.msg);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"onReachBottom",value:function(){var e=this;e.haveMore&&(e.showBottomLoading=!0,e.page++,setTimeout(function(){e.loadAdminOrderList(),e.showBottomLoading=!1},500))}}]),u}();Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(orderAdmin,"pages/order-admin"));